<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HK Water Treatment Simulation - Final</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; color: #333; text-align: center; margin: 0; padding: 20px; }
        
        .header-panel { background: #2c3e50; color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        canvas { background: #ffffff; border: 4px solid #2c3e50; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); cursor: crosshair; }
        
        button { 
            padding: 12px 25px; font-size: 16px; font-weight: bold; cursor: pointer; 
            background: #27ae60; color: white; border: none; border-radius: 6px; 
            transition: 0.3s; margin: 10px;
        }
        button:hover { background: #2ecc71; transform: translateY(-2px); }

        /* Description Box at the Bottom */
        #info-panel {
            margin-top: 25px;
            width: 960px;
            background: #ffffff;
            border-top: 5px solid #3498db;
            padding: 20px;
            border-radius: 8px;
            display: inline-block;
            text-align: left;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .info-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .info-item strong { color: #2980b9; text-transform: capitalize; }
    </style>
</head>
<body>

    <div class="header-panel">
        <h1>Water Treatment Process in Hong Kong</h1>
        <button onclick="addWater()">Release Raw Water</button>
    </div>

    <canvas id="simCanvas" width="1000" height="600"></canvas>

    <!-- Bottom Box Displaying All Content -->
    <div id="info-panel">
        <h3 style="margin-top:0; color:#2c3e50;">Process Description:</h3>
        <div class="info-grid">
            <div class="info-item"><strong>Screen:</strong> remove large solid by filtration</div>
            <div class="info-item"><strong>Rapid Mix Chamber:</strong> alum is added to the water and mixed</div>
            <div class="info-item"><strong>Clarifier:</strong> heavy solid impurities sink to the bottom</div>
            <div class="info-item"><strong>Filtration Tank:</strong> suspended and floating solid impurities are removed</div>
            <div class="info-item"><strong>Chlorine:</strong> kill microorganisms</div>
            <div class="info-item"><strong>Fluoride:</strong> prevent tooth decay</div>
        </div>
    </div>

<script>
const canvas = document.getElementById('simCanvas');
const ctx = canvas.getContext('2d');
let particles = [];
let mouseX = 0, mouseY = 0;

// Interactive Hit Zones
const regions = [
    { x: 130, y: 50, w: 40, h: 100, name: "Screen" },
    { x: 250, y: 60, w: 150, h: 80, name: "Rapid Mix" },
    { x: 550, y: 40, w: 160, h: 180, name: "Clarifier" },
    { x: 830, y: 100, w: 100, h: 150, name: "Filtration" },
    { x: 735, y: 425, w: 30, h: 50, name: "Chlorine" },
    { x: 585, y: 425, w: 30, h: 50, name: "Fluoride" }
];

class WaterParticle {
    constructor() {
        this.x = 0; this.y = 100;
        this.stage = "raw"; this.color = "#8b4513";
        this.size = 5; this.speed = 2;
        this.isSludge = Math.random() < 0.25;
    }

    update() {
        if (this.stage === "raw") {
            this.x += this.speed;
            if (this.x > 250) this.stage = "mixing";
        } else if (this.stage === "mixing") {
            this.x += this.speed; this.y += Math.sin(this.x * 0.2) * 2;
            if (this.x > 400) this.stage = "clarifier";
        } else if (this.stage === "clarifier") {
            this.x += this.speed;
            if (this.y > 100) this.y -= 0.5;
            // Sludge logic: remove in the middle (approx 630)
            if (this.isSludge && this.x >= 630 && this.x <= 635) this.stage = "sludge_exit";
            if (this.x > 880) this.stage = "filtering";
        } else if (this.stage === "sludge_exit") {
            this.x = 630; this.y += this.speed;
            if (this.y > 220) this.x = -100;
        } else if (this.stage === "filtering") {
            this.x = 880; this.y += this.speed;
            if (this.y > 200) this.color = "#00d4ff"; // Turns clean
            if (this.y > 450) this.stage = "disinfection";
        } else if (this.stage === "disinfection") {
            this.x -= this.speed * 2;
            if (this.x < 150) this.stage = "pump_drop";
        } else if (this.stage === "pump_drop") {
            // Drop downward at the center of pump station (x=150)
            this.x = 150; this.y += this.speed;
            if (this.y > 600) this.x = -100;
        }
    }

    draw() {
        ctx.fillStyle = this.color;
        ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
    }
}

function drawEnvironment() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Highlight hovered area
    regions.forEach(r => {
        if (mouseX > r.x && mouseX < r.x + r.w && mouseY > r.y && mouseY < r.y + r.h) {
            ctx.fillStyle = "rgba(52, 152, 219, 0.15)";
            ctx.fillRect(r.x, r.y, r.w, r.h);
        }
    });

    // PIPES
    ctx.lineWidth = 20; ctx.strokeStyle = "#cfe2f3"; ctx.lineCap = "round";
    ctx.beginPath();
    ctx.moveTo(0, 100); ctx.lineTo(550, 100); ctx.moveTo(710, 100); ctx.lineTo(880, 100);
    ctx.lineTo(880, 450); ctx.lineTo(150, 450); ctx.lineTo(150, 600);
    ctx.stroke();

    // SCREEN
    ctx.strokeStyle = "#95a5a6"; ctx.lineWidth = 5;
    ctx.beginPath(); ctx.moveTo(150, 50); ctx.lineTo(150, 150); ctx.stroke();

    // TANKS
    ctx.lineWidth = 2; ctx.strokeStyle = "#2c3e50"; ctx.fillStyle = "#ecf0f1";
    // Mix Chamber
    ctx.fillRect(250, 60, 150, 80); ctx.strokeRect(250, 60, 150, 80);
    // Clarifier
    ctx.beginPath();
    ctx.moveTo(550, 40); ctx.lineTo(710, 40); ctx.lineTo(660, 180); ctx.lineTo(660, 220);
    ctx.lineTo(600, 220); ctx.lineTo(600, 180); ctx.closePath(); ctx.fill(); ctx.stroke();
    // Filter layers
    ctx.fillStyle = "#4b3621"; ctx.fillRect(830, 100, 100, 50);
    ctx.fillStyle = "#d2b48c"; ctx.fillRect(830, 150, 100, 50);
    ctx.fillStyle = "#95a5a6"; ctx.fillRect(830, 200, 100, 50);
    ctx.strokeRect(830, 100, 100, 150);
    // Pump Station
    ctx.fillStyle = "#bdc3c7"; ctx.fillRect(100, 410, 100, 80); ctx.strokeRect(100, 410, 100, 80);
    ctx.fillStyle = "#2c3e50"; ctx.fillRect(120, 430, 20, 15); ctx.fillRect(160, 430, 20, 15);

    // CHEMICAL INJECTORS
    function drawChem(x, y, color, label) {
        ctx.fillStyle = color;
        ctx.beginPath(); ctx.arc(x, y-10, 10, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = "#000"; ctx.font = "bold 12px Arial"; ctx.fillText(label, x-25, y-25);
    }
    drawChem(325, 60, "orange", "ALUM");
    drawChem(750, 440, "green", "CHLORINE");
    drawChem(600, 440, "red", "FLUORIDE");

    // PERMANENT LABELS
    ctx.fillStyle = "#34495e"; ctx.font = "bold 13px Arial";
    ctx.fillText("Raw Water Intake", 10, 80);
    ctx.fillText("Screen", 130, 165);
    ctx.fillText("Rapid Mix Chamber", 265, 155);
    ctx.fillText("CLARIFIER", 605, 30);
    ctx.fillText("Sludge Removal (Mid)", 560, 240);
    ctx.fillText("Filtration Tank", 830, 90);
    ctx.fillText("Disinfection Pipe", 630, 480);
    ctx.fillText("PUMP STATION", 100, 400);
    ctx.fillText("To Distribution", 170, 580);
}

canvas.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    mouseX = e.clientX - rect.left;
    mouseY = e.clientY - rect.top;
});

function addWater() {
    for(let i=0; i<15; i++) setTimeout(() => particles.push(new WaterParticle()), i * 250);
}

function animate() {
    drawEnvironment();
    particles.forEach((p, index) => {
        p.update(); p.draw();
        if (p.x < -50) particles.splice(index, 1);
    });
    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
